#!/bin/bash

provider=letsencrypt
port=12443
src=/etc/apache2/sites-available/default-ssl.conf

dst=$(dirname $src)/$provider-ssl.conf
cp $src $dst

cert=/etc/letsencrypt/live/$(dnsdomainname)/fullchain.pem
key=/etc/letsencrypt/live/$(dnsdomainname)/privkey.pem
sed -i -r -e "s|^(\s*[^#]\s*SSLCertificateFile)\s*\S*|\1 $cert|" $dst
sed -i -r -e "s|^(\s*[^#]\s*SSLCertificateKeyFile)\s*\S*|\1 $key|" $dst

a2dissite -q $(basename $src)
a2ensite -q $(basename $dst)
systemctl -q reload apache2

exit 0